stages:
  extract:
    cmd: PYTHONPATH=. python3 scripts/cpi/extract.py
    always_changed: true
    wdir: ../..
    deps:
      - scripts/cpi/extract.py
    outs:
      - working/cpi/consumerpriceinflationdetailedreferencetables.xlsx:
          cache: false
          persist: false
      - working/cpi/mm23.csv:
          cache: false
          persist: false
  transform:
    cmd: PYTHONPATH=. python3 scripts/cpi/transform.py
    wdir: ../..
    deps:
      - scripts/cpi/transform.py
      - scripts/util/date.py
      - working/cpi/consumerpriceinflationdetailedreferencetables.xlsx
      - working/cpi/mm23.csv
      - working/lookups/MM23_variable_lookup.csv
    outs:
      - data/cpi/cpi.csv:
          cache: false
          persist: false
      - src/_data/sources/cpi/headlines.csv:
          cache: false 
          persist: false
      - data/cpi/metadata.json:
          cache: false 
          persist: false
  prepare:
    cmd: PYTHONPATH=. python3 scripts/cpi/prepare.py
    wdir: ../..
    deps:
      - scripts/cpi/prepare.py
      - data/cpi/cpi.csv
      - data/cpi/metadata.json
    outs:
      - src/_data/sources/cpi/cpi.csv:
          cache: false
          persist: false
      - src/_data/sources/cpi/metadata.json:
          cache: false
          persist: false
  vis:
    cmd: PYTHONPATH=. python3 scripts/cpi/vis.py
    wdir: ../..
    deps:
      - scripts/cpi/vis.py
      - data/cpi/cpi.csv
      - scripts/util/util.py
      - src/dashboard/cpi/_data/visualisations.yaml
    # outs:
    #   - src/dashboard/cpi/_data:
    #       cache: false
    #       persist: false